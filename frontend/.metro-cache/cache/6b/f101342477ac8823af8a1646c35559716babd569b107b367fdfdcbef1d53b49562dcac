{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":41,"index":41}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-av","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":42},"end":{"line":2,"column":32,"index":74}}],"key":"VxVG0TWBdB+Oc1qOQ32HKtN+H5M=","exportNames":["*"],"imports":1}},{"name":"expo-file-system","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":75},"end":{"line":3,"column":47,"index":122}}],"key":"6GyvFG3BsQPSqqu9QRKJ8hfZxPw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"useAudioPlayer\", {\n    enumerable: true,\n    get: function () {\n      return useAudioPlayer;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _expoAv = require(_dependencyMap[1], \"expo-av\");\n  var _expoFileSystem = require(_dependencyMap[2], \"expo-file-system\");\n  var FileSystem = _interopNamespace(_expoFileSystem);\n  const useAudioPlayer = () => {\n    _s();\n    const [isPlaying, setIsPlaying] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(false);\n    const soundRef = (0, _react.useRef)(null);\n    const cacheRef = (0, _react.useRef)({});\n    const playAudio = async (messageId, text, lang, backendUrl) => {\n      try {\n        // Check cache first\n        if (cacheRef.current[messageId]) {\n          console.log('🔊 Playing from cache:', messageId);\n          await playFromUri(cacheRef.current[messageId]);\n          return;\n        }\n        setIsLoading(true);\n        console.log('🔊 Fetching audio from TTS...');\n\n        // Request TTS from backend\n        const response = await fetch(`${backendUrl}/api/tts`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            text,\n            lang,\n            provider: 'elevenlabs'\n          })\n        });\n        if (!response.ok) {\n          throw new Error(`TTS failed: ${response.status}`);\n        }\n\n        // Download audio to local cache\n        const blob = await response.blob();\n        const reader = new FileReader();\n        reader.onloadend = async () => {\n          const base64Audio = reader.result;\n          const localUri = `${FileSystem.cacheDirectory}tts_${messageId}.mp3`;\n\n          // Save to file system\n          await FileSystem.writeAsStringAsync(localUri, base64Audio.split(',')[1], {\n            encoding: 'base64'\n          });\n\n          // Cache the URI\n          cacheRef.current[messageId] = localUri;\n          console.log('✅ Audio cached:', localUri);\n          await playFromUri(localUri);\n        };\n        reader.readAsDataURL(blob);\n      } catch (error) {\n        console.error('❌ Audio playback error:', error);\n        setIsLoading(false);\n      }\n    };\n    const playFromUri = async uri => {\n      try {\n        // Stop any currently playing sound\n        if (soundRef.current) {\n          await soundRef.current.stopAsync();\n          await soundRef.current.unloadAsync();\n        }\n\n        // Set audio mode\n        await _expoAv.Audio.setAudioModeAsync({\n          allowsRecordingIOS: false,\n          playsInSilentModeIOS: true,\n          shouldDuckAndroid: true,\n          playThroughEarpieceAndroid: false\n        });\n        console.log('🔊 Loading sound:', uri);\n        const {\n          sound\n        } = await _expoAv.Audio.Sound.createAsync({\n          uri\n        }, {\n          shouldPlay: true\n        }, onPlaybackStatusUpdate);\n        soundRef.current = sound;\n        setIsLoading(false);\n        setIsPlaying(true);\n      } catch (error) {\n        console.error('❌ Failed to play audio:', error);\n        setIsLoading(false);\n        setIsPlaying(false);\n      }\n    };\n    const onPlaybackStatusUpdate = status => {\n      if (status.didJustFinish) {\n        console.log('✅ Audio finished playing');\n        setIsPlaying(false);\n        if (soundRef.current) {\n          soundRef.current.unloadAsync();\n        }\n      }\n    };\n    const stopAudio = async () => {\n      if (soundRef.current) {\n        await soundRef.current.stopAsync();\n        await soundRef.current.unloadAsync();\n        soundRef.current = null;\n      }\n      setIsPlaying(false);\n    };\n    return {\n      isPlaying,\n      isLoading,\n      playAudio,\n      stopAudio\n    };\n  };\n  _s(useAudioPlayer, \"crdKrPtVI1HOnOWWBSi9kosOb8o=\");\n});","lineCount":146,"map":[[23,2,9,0,"Object"],[23,8,9,0],[23,9,9,0,"defineProperty"],[23,23,9,0],[23,24,9,0,"exports"],[23,31,9,0],[24,4,9,0,"enumerable"],[24,14,9,0],[25,4,9,0,"get"],[25,7,9,0],[25,18,9,0,"get"],[25,19,9,0],[26,6,9,0],[26,13,9,0,"useAudioPlayer"],[26,27,9,0],[27,4,9,0],[28,2,9,0],[29,2,1,0],[29,6,1,0,"_react"],[29,12,1,0],[29,15,1,0,"require"],[29,22,1,0],[29,23,1,0,"_dependencyMap"],[29,37,1,0],[30,2,2,0],[30,6,2,0,"_expoAv"],[30,13,2,0],[30,16,2,0,"require"],[30,23,2,0],[30,24,2,0,"_dependencyMap"],[30,38,2,0],[31,2,3,0],[31,6,3,0,"_expoFileSystem"],[31,21,3,0],[31,24,3,0,"require"],[31,31,3,0],[31,32,3,0,"_dependencyMap"],[31,46,3,0],[32,2,3,0],[32,6,3,0,"FileSystem"],[32,16,3,0],[32,19,3,0,"_interopNamespace"],[32,36,3,0],[32,37,3,0,"_expoFileSystem"],[32,52,3,0],[33,2,9,7],[33,8,9,13,"useAudioPlayer"],[33,22,9,27],[33,25,9,30,"useAudioPlayer"],[33,26,9,30],[33,31,9,36],[34,4,9,36,"_s"],[34,6,9,36],[35,4,10,2],[35,10,10,8],[35,11,10,9,"isPlaying"],[35,20,10,18],[35,22,10,20,"setIsPlaying"],[35,34,10,32],[35,35,10,33],[35,38,10,36],[35,42,10,36,"useState"],[35,48,10,44],[35,49,10,44,"useState"],[35,57,10,44],[35,59,10,45],[35,64,10,50],[35,65,10,51],[36,4,11,2],[36,10,11,8],[36,11,11,9,"isLoading"],[36,20,11,18],[36,22,11,20,"setIsLoading"],[36,34,11,32],[36,35,11,33],[36,38,11,36],[36,42,11,36,"useState"],[36,48,11,44],[36,49,11,44,"useState"],[36,57,11,44],[36,59,11,45],[36,64,11,50],[36,65,11,51],[37,4,12,2],[37,10,12,8,"soundRef"],[37,18,12,16],[37,21,12,19],[37,25,12,19,"useRef"],[37,31,12,25],[37,32,12,25,"useRef"],[37,38,12,25],[37,40,12,46],[37,44,12,50],[37,45,12,51],[38,4,13,2],[38,10,13,8,"cacheRef"],[38,18,13,16],[38,21,13,19],[38,25,13,19,"useRef"],[38,31,13,25],[38,32,13,25,"useRef"],[38,38,13,25],[38,40,13,38],[38,41,13,39],[38,42,13,40],[38,43,13,41],[39,4,15,2],[39,10,15,8,"playAudio"],[39,19,15,17],[39,22,15,20],[39,28,15,20,"playAudio"],[39,29,15,27,"messageId"],[39,38,15,44],[39,40,15,46,"text"],[39,44,15,58],[39,46,15,60,"lang"],[39,50,15,72],[39,52,15,74,"backendUrl"],[39,62,15,92],[39,67,15,97],[40,6,16,4],[40,10,16,8],[41,8,17,6],[42,8,18,6],[42,12,18,10,"cacheRef"],[42,20,18,18],[42,21,18,19,"current"],[42,28,18,26],[42,29,18,27,"messageId"],[42,38,18,36],[42,39,18,37],[42,41,18,39],[43,10,19,8,"console"],[43,17,19,15],[43,18,19,16,"log"],[43,21,19,19],[43,22,19,20],[43,46,19,44],[43,48,19,46,"messageId"],[43,57,19,55],[43,58,19,56],[44,10,20,8],[44,16,20,14,"playFromUri"],[44,27,20,25],[44,28,20,26,"cacheRef"],[44,36,20,34],[44,37,20,35,"current"],[44,44,20,42],[44,45,20,43,"messageId"],[44,54,20,52],[44,55,20,53],[44,56,20,54],[45,10,21,8],[46,8,22,6],[47,8,24,6,"setIsLoading"],[47,20,24,18],[47,21,24,19],[47,25,24,23],[47,26,24,24],[48,8,25,6,"console"],[48,15,25,13],[48,16,25,14,"log"],[48,19,25,17],[48,20,25,18],[48,51,25,49],[48,52,25,50],[50,8,27,6],[51,8,28,6],[51,14,28,12,"response"],[51,22,28,20],[51,25,28,23],[51,31,28,29,"fetch"],[51,36,28,34],[51,37,28,35],[51,40,28,38,"backendUrl"],[51,50,28,48],[51,60,28,58],[51,62,28,60],[52,10,29,8,"method"],[52,16,29,14],[52,18,29,16],[52,24,29,22],[53,10,30,8,"headers"],[53,17,30,15],[53,19,30,17],[54,12,31,10],[54,26,31,24],[54,28,31,26],[55,10,32,8],[55,11,32,9],[56,10,33,8,"body"],[56,14,33,12],[56,16,33,14,"JSON"],[56,20,33,18],[56,21,33,19,"stringify"],[56,30,33,28],[56,31,33,29],[57,12,33,31,"text"],[57,16,33,35],[58,12,33,37,"lang"],[58,16,33,41],[59,12,33,43,"provider"],[59,20,33,51],[59,22,33,53],[60,10,33,66],[60,11,33,67],[61,8,34,6],[61,9,34,7],[61,10,34,8],[62,8,36,6],[62,12,36,10],[62,13,36,11,"response"],[62,21,36,19],[62,22,36,20,"ok"],[62,24,36,22],[62,26,36,24],[63,10,37,8],[63,16,37,14],[63,20,37,18,"Error"],[63,25,37,23],[63,26,37,24],[63,41,37,39,"response"],[63,49,37,47],[63,50,37,48,"status"],[63,56,37,54],[63,58,37,56],[63,59,37,57],[64,8,38,6],[66,8,40,6],[67,8,41,6],[67,14,41,12,"blob"],[67,18,41,16],[67,21,41,19],[67,27,41,25,"response"],[67,35,41,33],[67,36,41,34,"blob"],[67,40,41,38],[67,41,41,39],[67,42,41,40],[68,8,42,6],[68,14,42,12,"reader"],[68,20,42,18],[68,23,42,21],[68,27,42,25,"FileReader"],[68,37,42,35],[68,38,42,36],[68,39,42,37],[69,8,44,6,"reader"],[69,14,44,12],[69,15,44,13,"onloadend"],[69,24,44,22],[69,27,44,25],[69,39,44,37],[70,10,45,8],[70,16,45,14,"base64Audio"],[70,27,45,25],[70,30,45,28,"reader"],[70,36,45,34],[70,37,45,35,"result"],[70,43,45,51],[71,10,46,8],[71,16,46,14,"localUri"],[71,24,46,22],[71,27,46,25],[71,30,46,28,"FileSystem"],[71,40,46,38],[71,41,46,39,"cacheDirectory"],[71,55,46,53],[71,62,46,60,"messageId"],[71,71,46,69],[71,77,46,75],[73,10,48,8],[74,10,49,8],[74,16,49,14,"FileSystem"],[74,26,49,24],[74,27,49,25,"writeAsStringAsync"],[74,45,49,43],[74,46,50,10,"localUri"],[74,54,50,18],[74,56,51,10,"base64Audio"],[74,67,51,21],[74,68,51,22,"split"],[74,73,51,27],[74,74,51,28],[74,77,51,31],[74,78,51,32],[74,79,51,33],[74,80,51,34],[74,81,51,35],[74,83,52,10],[75,12,52,12,"encoding"],[75,20,52,20],[75,22,52,22],[76,10,52,58],[76,11,53,8],[76,12,53,9],[78,10,55,8],[79,10,56,8,"cacheRef"],[79,18,56,16],[79,19,56,17,"current"],[79,26,56,24],[79,27,56,25,"messageId"],[79,36,56,34],[79,37,56,35],[79,40,56,38,"localUri"],[79,48,56,46],[80,10,58,8,"console"],[80,17,58,15],[80,18,58,16,"log"],[80,21,58,19],[80,22,58,20],[80,39,58,37],[80,41,58,39,"localUri"],[80,49,58,47],[80,50,58,48],[81,10,59,8],[81,16,59,14,"playFromUri"],[81,27,59,25],[81,28,59,26,"localUri"],[81,36,59,34],[81,37,59,35],[82,8,60,6],[82,9,60,7],[83,8,62,6,"reader"],[83,14,62,12],[83,15,62,13,"readAsDataURL"],[83,28,62,26],[83,29,62,27,"blob"],[83,33,62,31],[83,34,62,32],[84,6,63,4],[84,7,63,5],[84,8,63,6],[84,15,63,13,"error"],[84,20,63,18],[84,22,63,20],[85,8,64,6,"console"],[85,15,64,13],[85,16,64,14,"error"],[85,21,64,19],[85,22,64,20],[85,47,64,45],[85,49,64,47,"error"],[85,54,64,52],[85,55,64,53],[86,8,65,6,"setIsLoading"],[86,20,65,18],[86,21,65,19],[86,26,65,24],[86,27,65,25],[87,6,66,4],[88,4,67,2],[88,5,67,3],[89,4,69,2],[89,10,69,8,"playFromUri"],[89,21,69,19],[89,24,69,22],[89,30,69,29,"uri"],[89,33,69,40],[89,37,69,45],[90,6,70,4],[90,10,70,8],[91,8,71,6],[92,8,72,6],[92,12,72,10,"soundRef"],[92,20,72,18],[92,21,72,19,"current"],[92,28,72,26],[92,30,72,28],[93,10,73,8],[93,16,73,14,"soundRef"],[93,24,73,22],[93,25,73,23,"current"],[93,32,73,30],[93,33,73,31,"stopAsync"],[93,42,73,40],[93,43,73,41],[93,44,73,42],[94,10,74,8],[94,16,74,14,"soundRef"],[94,24,74,22],[94,25,74,23,"current"],[94,32,74,30],[94,33,74,31,"unloadAsync"],[94,44,74,42],[94,45,74,43],[94,46,74,44],[95,8,75,6],[97,8,77,6],[98,8,78,6],[98,14,78,12,"Audio"],[98,21,78,17],[98,22,78,17,"Audio"],[98,27,78,17],[98,28,78,18,"setAudioModeAsync"],[98,45,78,35],[98,46,78,36],[99,10,79,8,"allowsRecordingIOS"],[99,28,79,26],[99,30,79,28],[99,35,79,33],[100,10,80,8,"playsInSilentModeIOS"],[100,30,80,28],[100,32,80,30],[100,36,80,34],[101,10,81,8,"shouldDuckAndroid"],[101,27,81,25],[101,29,81,27],[101,33,81,31],[102,10,82,8,"playThroughEarpieceAndroid"],[102,36,82,34],[102,38,82,36],[103,8,83,6],[103,9,83,7],[103,10,83,8],[104,8,85,6,"console"],[104,15,85,13],[104,16,85,14,"log"],[104,19,85,17],[104,20,85,18],[104,39,85,37],[104,41,85,39,"uri"],[104,44,85,42],[104,45,85,43],[105,8,86,6],[105,14,86,12],[106,10,86,14,"sound"],[107,8,86,20],[107,9,86,21],[107,12,86,24],[107,18,86,30,"Audio"],[107,25,86,35],[107,26,86,35,"Audio"],[107,31,86,35],[107,32,86,36,"Sound"],[107,37,86,41],[107,38,86,42,"createAsync"],[107,49,86,53],[107,50,87,8],[108,10,87,10,"uri"],[109,8,87,14],[109,9,87,15],[109,11,88,8],[110,10,88,10,"shouldPlay"],[110,20,88,20],[110,22,88,22],[111,8,88,27],[111,9,88,28],[111,11,89,8,"onPlaybackStatusUpdate"],[111,33,90,6],[111,34,90,7],[112,8,92,6,"soundRef"],[112,16,92,14],[112,17,92,15,"current"],[112,24,92,22],[112,27,92,25,"sound"],[112,32,92,30],[113,8,93,6,"setIsLoading"],[113,20,93,18],[113,21,93,19],[113,26,93,24],[113,27,93,25],[114,8,94,6,"setIsPlaying"],[114,20,94,18],[114,21,94,19],[114,25,94,23],[114,26,94,24],[115,6,95,4],[115,7,95,5],[115,8,95,6],[115,15,95,13,"error"],[115,20,95,18],[115,22,95,20],[116,8,96,6,"console"],[116,15,96,13],[116,16,96,14,"error"],[116,21,96,19],[116,22,96,20],[116,47,96,45],[116,49,96,47,"error"],[116,54,96,52],[116,55,96,53],[117,8,97,6,"setIsLoading"],[117,20,97,18],[117,21,97,19],[117,26,97,24],[117,27,97,25],[118,8,98,6,"setIsPlaying"],[118,20,98,18],[118,21,98,19],[118,26,98,24],[118,27,98,25],[119,6,99,4],[120,4,100,2],[120,5,100,3],[121,4,102,2],[121,10,102,8,"onPlaybackStatusUpdate"],[121,32,102,30],[121,35,102,34,"status"],[121,41,102,45],[121,45,102,50],[122,6,103,4],[122,10,103,8,"status"],[122,16,103,14],[122,17,103,15,"didJustFinish"],[122,30,103,28],[122,32,103,30],[123,8,104,6,"console"],[123,15,104,13],[123,16,104,14,"log"],[123,19,104,17],[123,20,104,18],[123,46,104,44],[123,47,104,45],[124,8,105,6,"setIsPlaying"],[124,20,105,18],[124,21,105,19],[124,26,105,24],[124,27,105,25],[125,8,106,6],[125,12,106,10,"soundRef"],[125,20,106,18],[125,21,106,19,"current"],[125,28,106,26],[125,30,106,28],[126,10,107,8,"soundRef"],[126,18,107,16],[126,19,107,17,"current"],[126,26,107,24],[126,27,107,25,"unloadAsync"],[126,38,107,36],[126,39,107,37],[126,40,107,38],[127,8,108,6],[128,6,109,4],[129,4,110,2],[129,5,110,3],[130,4,112,2],[130,10,112,8,"stopAudio"],[130,19,112,17],[130,22,112,20],[130,28,112,20,"stopAudio"],[130,29,112,20],[130,34,112,32],[131,6,113,4],[131,10,113,8,"soundRef"],[131,18,113,16],[131,19,113,17,"current"],[131,26,113,24],[131,28,113,26],[132,8,114,6],[132,14,114,12,"soundRef"],[132,22,114,20],[132,23,114,21,"current"],[132,30,114,28],[132,31,114,29,"stopAsync"],[132,40,114,38],[132,41,114,39],[132,42,114,40],[133,8,115,6],[133,14,115,12,"soundRef"],[133,22,115,20],[133,23,115,21,"current"],[133,30,115,28],[133,31,115,29,"unloadAsync"],[133,42,115,40],[133,43,115,41],[133,44,115,42],[134,8,116,6,"soundRef"],[134,16,116,14],[134,17,116,15,"current"],[134,24,116,22],[134,27,116,25],[134,31,116,29],[135,6,117,4],[136,6,118,4,"setIsPlaying"],[136,18,118,16],[136,19,118,17],[136,24,118,22],[136,25,118,23],[137,4,119,2],[137,5,119,3],[138,4,121,2],[138,11,121,9],[139,6,122,4,"isPlaying"],[139,15,122,13],[140,6,123,4,"isLoading"],[140,15,123,13],[141,6,124,4,"playAudio"],[141,15,124,13],[142,6,125,4,"stopAudio"],[143,4,126,2],[143,5,126,3],[144,2,127,0],[144,3,127,1],[145,2,127,2,"_s"],[145,4,127,2],[145,5,9,13,"useAudioPlayer"],[145,19,9,27],[146,0,9,27],[146,3]],"functionMap":{"names":["<global>","useAudioPlayer","playAudio","reader.onloadend","playFromUri","onPlaybackStatusUpdate","stopAudio"],"mappings":"AAA;8BCQ;oBCM;yBC6B;ODgB;GDO;sBGE;GH+B;iCIE;GJQ;oBKE;GLO;CDQ"},"hasCjsExports":false},"type":"js/module"}]}