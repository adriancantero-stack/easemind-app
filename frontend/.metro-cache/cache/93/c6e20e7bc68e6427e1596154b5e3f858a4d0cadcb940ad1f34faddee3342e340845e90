{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":41,"index":41}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-av","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":42},"end":{"line":2,"column":32,"index":74}}],"key":"VxVG0TWBdB+Oc1qOQ32HKtN+H5M=","exportNames":["*"],"imports":1}},{"name":"expo-file-system","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":75},"end":{"line":3,"column":47,"index":122}}],"key":"6GyvFG3BsQPSqqu9QRKJ8hfZxPw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"useAudioPlayer\", {\n    enumerable: true,\n    get: function () {\n      return useAudioPlayer;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _expoAv = require(_dependencyMap[1], \"expo-av\");\n  var _expoFileSystem = require(_dependencyMap[2], \"expo-file-system\");\n  var FileSystem = _interopNamespace(_expoFileSystem);\n  const useAudioPlayer = () => {\n    const [isPlaying, setIsPlaying] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(false);\n    const soundRef = (0, _react.useRef)(null);\n    const cacheRef = (0, _react.useRef)({});\n    const playAudio = async (messageId, text, lang, backendUrl) => {\n      try {\n        // Check cache first\n        if (cacheRef.current[messageId]) {\n          console.log('🔊 Playing from cache:', messageId);\n          await playFromUri(cacheRef.current[messageId]);\n          return;\n        }\n        setIsLoading(true);\n        console.log('🔊 Fetching audio from TTS...');\n\n        // Request TTS from backend\n        const response = await fetch(`${backendUrl}/api/tts`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            text,\n            lang,\n            provider: 'elevenlabs'\n          })\n        });\n        if (!response.ok) {\n          throw new Error(`TTS failed: ${response.status}`);\n        }\n\n        // Download audio to local cache\n        const blob = await response.blob();\n        const reader = new FileReader();\n        reader.onloadend = async () => {\n          const base64Audio = reader.result;\n          const localUri = `${FileSystem.cacheDirectory}tts_${messageId}.mp3`;\n\n          // Save to file system\n          await FileSystem.writeAsStringAsync(localUri, base64Audio.split(',')[1], {\n            encoding: FileSystem.EncodingType.Base64\n          });\n\n          // Cache the URI\n          cacheRef.current[messageId] = localUri;\n          console.log('✅ Audio cached:', localUri);\n          await playFromUri(localUri);\n        };\n        reader.readAsDataURL(blob);\n      } catch (error) {\n        console.error('❌ Audio playback error:', error);\n        setIsLoading(false);\n      }\n    };\n    const playFromUri = async uri => {\n      try {\n        // Stop any currently playing sound\n        if (soundRef.current) {\n          await soundRef.current.stopAsync();\n          await soundRef.current.unloadAsync();\n        }\n\n        // Set audio mode\n        await _expoAv.Audio.setAudioModeAsync({\n          allowsRecordingIOS: false,\n          playsInSilentModeIOS: true,\n          shouldDuckAndroid: true,\n          playThroughEarpieceAndroid: false\n        });\n        console.log('🔊 Loading sound:', uri);\n        const {\n          sound\n        } = await _expoAv.Audio.Sound.createAsync({\n          uri\n        }, {\n          shouldPlay: true\n        }, onPlaybackStatusUpdate);\n        soundRef.current = sound;\n        setIsLoading(false);\n        setIsPlaying(true);\n      } catch (error) {\n        console.error('❌ Failed to play audio:', error);\n        setIsLoading(false);\n        setIsPlaying(false);\n      }\n    };\n    const onPlaybackStatusUpdate = status => {\n      if (status.didJustFinish) {\n        console.log('✅ Audio finished playing');\n        setIsPlaying(false);\n        if (soundRef.current) {\n          soundRef.current.unloadAsync();\n        }\n      }\n    };\n    const stopAudio = async () => {\n      if (soundRef.current) {\n        await soundRef.current.stopAsync();\n        await soundRef.current.unloadAsync();\n        soundRef.current = null;\n      }\n      setIsPlaying(false);\n    };\n    return {\n      isPlaying,\n      isLoading,\n      playAudio,\n      stopAudio\n    };\n  };\n});","lineCount":143,"map":[[22,2,9,0,"Object"],[22,8,9,0],[22,9,9,0,"defineProperty"],[22,23,9,0],[22,24,9,0,"exports"],[22,31,9,0],[23,4,9,0,"enumerable"],[23,14,9,0],[24,4,9,0,"get"],[24,7,9,0],[24,18,9,0,"get"],[24,19,9,0],[25,6,9,0],[25,13,9,0,"useAudioPlayer"],[25,27,9,0],[26,4,9,0],[27,2,9,0],[28,2,1,0],[28,6,1,0,"_react"],[28,12,1,0],[28,15,1,0,"require"],[28,22,1,0],[28,23,1,0,"_dependencyMap"],[28,37,1,0],[29,2,2,0],[29,6,2,0,"_expoAv"],[29,13,2,0],[29,16,2,0,"require"],[29,23,2,0],[29,24,2,0,"_dependencyMap"],[29,38,2,0],[30,2,3,0],[30,6,3,0,"_expoFileSystem"],[30,21,3,0],[30,24,3,0,"require"],[30,31,3,0],[30,32,3,0,"_dependencyMap"],[30,46,3,0],[31,2,3,0],[31,6,3,0,"FileSystem"],[31,16,3,0],[31,19,3,0,"_interopNamespace"],[31,36,3,0],[31,37,3,0,"_expoFileSystem"],[31,52,3,0],[32,2,9,7],[32,8,9,13,"useAudioPlayer"],[32,22,9,27],[32,25,9,30,"useAudioPlayer"],[32,26,9,30],[32,31,9,36],[33,4,10,2],[33,10,10,8],[33,11,10,9,"isPlaying"],[33,20,10,18],[33,22,10,20,"setIsPlaying"],[33,34,10,32],[33,35,10,33],[33,38,10,36],[33,42,10,36,"useState"],[33,48,10,44],[33,49,10,44,"useState"],[33,57,10,44],[33,59,10,45],[33,64,10,50],[33,65,10,51],[34,4,11,2],[34,10,11,8],[34,11,11,9,"isLoading"],[34,20,11,18],[34,22,11,20,"setIsLoading"],[34,34,11,32],[34,35,11,33],[34,38,11,36],[34,42,11,36,"useState"],[34,48,11,44],[34,49,11,44,"useState"],[34,57,11,44],[34,59,11,45],[34,64,11,50],[34,65,11,51],[35,4,12,2],[35,10,12,8,"soundRef"],[35,18,12,16],[35,21,12,19],[35,25,12,19,"useRef"],[35,31,12,25],[35,32,12,25,"useRef"],[35,38,12,25],[35,40,12,46],[35,44,12,50],[35,45,12,51],[36,4,13,2],[36,10,13,8,"cacheRef"],[36,18,13,16],[36,21,13,19],[36,25,13,19,"useRef"],[36,31,13,25],[36,32,13,25,"useRef"],[36,38,13,25],[36,40,13,38],[36,41,13,39],[36,42,13,40],[36,43,13,41],[37,4,15,2],[37,10,15,8,"playAudio"],[37,19,15,17],[37,22,15,20],[37,28,15,20,"playAudio"],[37,29,15,27,"messageId"],[37,38,15,44],[37,40,15,46,"text"],[37,44,15,58],[37,46,15,60,"lang"],[37,50,15,72],[37,52,15,74,"backendUrl"],[37,62,15,92],[37,67,15,97],[38,6,16,4],[38,10,16,8],[39,8,17,6],[40,8,18,6],[40,12,18,10,"cacheRef"],[40,20,18,18],[40,21,18,19,"current"],[40,28,18,26],[40,29,18,27,"messageId"],[40,38,18,36],[40,39,18,37],[40,41,18,39],[41,10,19,8,"console"],[41,17,19,15],[41,18,19,16,"log"],[41,21,19,19],[41,22,19,20],[41,46,19,44],[41,48,19,46,"messageId"],[41,57,19,55],[41,58,19,56],[42,10,20,8],[42,16,20,14,"playFromUri"],[42,27,20,25],[42,28,20,26,"cacheRef"],[42,36,20,34],[42,37,20,35,"current"],[42,44,20,42],[42,45,20,43,"messageId"],[42,54,20,52],[42,55,20,53],[42,56,20,54],[43,10,21,8],[44,8,22,6],[45,8,24,6,"setIsLoading"],[45,20,24,18],[45,21,24,19],[45,25,24,23],[45,26,24,24],[46,8,25,6,"console"],[46,15,25,13],[46,16,25,14,"log"],[46,19,25,17],[46,20,25,18],[46,51,25,49],[46,52,25,50],[48,8,27,6],[49,8,28,6],[49,14,28,12,"response"],[49,22,28,20],[49,25,28,23],[49,31,28,29,"fetch"],[49,36,28,34],[49,37,28,35],[49,40,28,38,"backendUrl"],[49,50,28,48],[49,60,28,58],[49,62,28,60],[50,10,29,8,"method"],[50,16,29,14],[50,18,29,16],[50,24,29,22],[51,10,30,8,"headers"],[51,17,30,15],[51,19,30,17],[52,12,31,10],[52,26,31,24],[52,28,31,26],[53,10,32,8],[53,11,32,9],[54,10,33,8,"body"],[54,14,33,12],[54,16,33,14,"JSON"],[54,20,33,18],[54,21,33,19,"stringify"],[54,30,33,28],[54,31,33,29],[55,12,33,31,"text"],[55,16,33,35],[56,12,33,37,"lang"],[56,16,33,41],[57,12,33,43,"provider"],[57,20,33,51],[57,22,33,53],[58,10,33,66],[58,11,33,67],[59,8,34,6],[59,9,34,7],[59,10,34,8],[60,8,36,6],[60,12,36,10],[60,13,36,11,"response"],[60,21,36,19],[60,22,36,20,"ok"],[60,24,36,22],[60,26,36,24],[61,10,37,8],[61,16,37,14],[61,20,37,18,"Error"],[61,25,37,23],[61,26,37,24],[61,41,37,39,"response"],[61,49,37,47],[61,50,37,48,"status"],[61,56,37,54],[61,58,37,56],[61,59,37,57],[62,8,38,6],[64,8,40,6],[65,8,41,6],[65,14,41,12,"blob"],[65,18,41,16],[65,21,41,19],[65,27,41,25,"response"],[65,35,41,33],[65,36,41,34,"blob"],[65,40,41,38],[65,41,41,39],[65,42,41,40],[66,8,42,6],[66,14,42,12,"reader"],[66,20,42,18],[66,23,42,21],[66,27,42,25,"FileReader"],[66,37,42,35],[66,38,42,36],[66,39,42,37],[67,8,44,6,"reader"],[67,14,44,12],[67,15,44,13,"onloadend"],[67,24,44,22],[67,27,44,25],[67,39,44,37],[68,10,45,8],[68,16,45,14,"base64Audio"],[68,27,45,25],[68,30,45,28,"reader"],[68,36,45,34],[68,37,45,35,"result"],[68,43,45,51],[69,10,46,8],[69,16,46,14,"localUri"],[69,24,46,22],[69,27,46,25],[69,30,46,28,"FileSystem"],[69,40,46,38],[69,41,46,39,"cacheDirectory"],[69,55,46,53],[69,62,46,60,"messageId"],[69,71,46,69],[69,77,46,75],[71,10,48,8],[72,10,49,8],[72,16,49,14,"FileSystem"],[72,26,49,24],[72,27,49,25,"writeAsStringAsync"],[72,45,49,43],[72,46,50,10,"localUri"],[72,54,50,18],[72,56,51,10,"base64Audio"],[72,67,51,21],[72,68,51,22,"split"],[72,73,51,27],[72,74,51,28],[72,77,51,31],[72,78,51,32],[72,79,51,33],[72,80,51,34],[72,81,51,35],[72,83,52,10],[73,12,52,12,"encoding"],[73,20,52,20],[73,22,52,22,"FileSystem"],[73,32,52,32],[73,33,52,33,"EncodingType"],[73,45,52,45],[73,46,52,46,"Base64"],[74,10,52,53],[74,11,53,8],[74,12,53,9],[76,10,55,8],[77,10,56,8,"cacheRef"],[77,18,56,16],[77,19,56,17,"current"],[77,26,56,24],[77,27,56,25,"messageId"],[77,36,56,34],[77,37,56,35],[77,40,56,38,"localUri"],[77,48,56,46],[78,10,58,8,"console"],[78,17,58,15],[78,18,58,16,"log"],[78,21,58,19],[78,22,58,20],[78,39,58,37],[78,41,58,39,"localUri"],[78,49,58,47],[78,50,58,48],[79,10,59,8],[79,16,59,14,"playFromUri"],[79,27,59,25],[79,28,59,26,"localUri"],[79,36,59,34],[79,37,59,35],[80,8,60,6],[80,9,60,7],[81,8,62,6,"reader"],[81,14,62,12],[81,15,62,13,"readAsDataURL"],[81,28,62,26],[81,29,62,27,"blob"],[81,33,62,31],[81,34,62,32],[82,6,63,4],[82,7,63,5],[82,8,63,6],[82,15,63,13,"error"],[82,20,63,18],[82,22,63,20],[83,8,64,6,"console"],[83,15,64,13],[83,16,64,14,"error"],[83,21,64,19],[83,22,64,20],[83,47,64,45],[83,49,64,47,"error"],[83,54,64,52],[83,55,64,53],[84,8,65,6,"setIsLoading"],[84,20,65,18],[84,21,65,19],[84,26,65,24],[84,27,65,25],[85,6,66,4],[86,4,67,2],[86,5,67,3],[87,4,69,2],[87,10,69,8,"playFromUri"],[87,21,69,19],[87,24,69,22],[87,30,69,29,"uri"],[87,33,69,40],[87,37,69,45],[88,6,70,4],[88,10,70,8],[89,8,71,6],[90,8,72,6],[90,12,72,10,"soundRef"],[90,20,72,18],[90,21,72,19,"current"],[90,28,72,26],[90,30,72,28],[91,10,73,8],[91,16,73,14,"soundRef"],[91,24,73,22],[91,25,73,23,"current"],[91,32,73,30],[91,33,73,31,"stopAsync"],[91,42,73,40],[91,43,73,41],[91,44,73,42],[92,10,74,8],[92,16,74,14,"soundRef"],[92,24,74,22],[92,25,74,23,"current"],[92,32,74,30],[92,33,74,31,"unloadAsync"],[92,44,74,42],[92,45,74,43],[92,46,74,44],[93,8,75,6],[95,8,77,6],[96,8,78,6],[96,14,78,12,"Audio"],[96,21,78,17],[96,22,78,17,"Audio"],[96,27,78,17],[96,28,78,18,"setAudioModeAsync"],[96,45,78,35],[96,46,78,36],[97,10,79,8,"allowsRecordingIOS"],[97,28,79,26],[97,30,79,28],[97,35,79,33],[98,10,80,8,"playsInSilentModeIOS"],[98,30,80,28],[98,32,80,30],[98,36,80,34],[99,10,81,8,"shouldDuckAndroid"],[99,27,81,25],[99,29,81,27],[99,33,81,31],[100,10,82,8,"playThroughEarpieceAndroid"],[100,36,82,34],[100,38,82,36],[101,8,83,6],[101,9,83,7],[101,10,83,8],[102,8,85,6,"console"],[102,15,85,13],[102,16,85,14,"log"],[102,19,85,17],[102,20,85,18],[102,39,85,37],[102,41,85,39,"uri"],[102,44,85,42],[102,45,85,43],[103,8,86,6],[103,14,86,12],[104,10,86,14,"sound"],[105,8,86,20],[105,9,86,21],[105,12,86,24],[105,18,86,30,"Audio"],[105,25,86,35],[105,26,86,35,"Audio"],[105,31,86,35],[105,32,86,36,"Sound"],[105,37,86,41],[105,38,86,42,"createAsync"],[105,49,86,53],[105,50,87,8],[106,10,87,10,"uri"],[107,8,87,14],[107,9,87,15],[107,11,88,8],[108,10,88,10,"shouldPlay"],[108,20,88,20],[108,22,88,22],[109,8,88,27],[109,9,88,28],[109,11,89,8,"onPlaybackStatusUpdate"],[109,33,90,6],[109,34,90,7],[110,8,92,6,"soundRef"],[110,16,92,14],[110,17,92,15,"current"],[110,24,92,22],[110,27,92,25,"sound"],[110,32,92,30],[111,8,93,6,"setIsLoading"],[111,20,93,18],[111,21,93,19],[111,26,93,24],[111,27,93,25],[112,8,94,6,"setIsPlaying"],[112,20,94,18],[112,21,94,19],[112,25,94,23],[112,26,94,24],[113,6,95,4],[113,7,95,5],[113,8,95,6],[113,15,95,13,"error"],[113,20,95,18],[113,22,95,20],[114,8,96,6,"console"],[114,15,96,13],[114,16,96,14,"error"],[114,21,96,19],[114,22,96,20],[114,47,96,45],[114,49,96,47,"error"],[114,54,96,52],[114,55,96,53],[115,8,97,6,"setIsLoading"],[115,20,97,18],[115,21,97,19],[115,26,97,24],[115,27,97,25],[116,8,98,6,"setIsPlaying"],[116,20,98,18],[116,21,98,19],[116,26,98,24],[116,27,98,25],[117,6,99,4],[118,4,100,2],[118,5,100,3],[119,4,102,2],[119,10,102,8,"onPlaybackStatusUpdate"],[119,32,102,30],[119,35,102,34,"status"],[119,41,102,45],[119,45,102,50],[120,6,103,4],[120,10,103,8,"status"],[120,16,103,14],[120,17,103,15,"didJustFinish"],[120,30,103,28],[120,32,103,30],[121,8,104,6,"console"],[121,15,104,13],[121,16,104,14,"log"],[121,19,104,17],[121,20,104,18],[121,46,104,44],[121,47,104,45],[122,8,105,6,"setIsPlaying"],[122,20,105,18],[122,21,105,19],[122,26,105,24],[122,27,105,25],[123,8,106,6],[123,12,106,10,"soundRef"],[123,20,106,18],[123,21,106,19,"current"],[123,28,106,26],[123,30,106,28],[124,10,107,8,"soundRef"],[124,18,107,16],[124,19,107,17,"current"],[124,26,107,24],[124,27,107,25,"unloadAsync"],[124,38,107,36],[124,39,107,37],[124,40,107,38],[125,8,108,6],[126,6,109,4],[127,4,110,2],[127,5,110,3],[128,4,112,2],[128,10,112,8,"stopAudio"],[128,19,112,17],[128,22,112,20],[128,28,112,20,"stopAudio"],[128,29,112,20],[128,34,112,32],[129,6,113,4],[129,10,113,8,"soundRef"],[129,18,113,16],[129,19,113,17,"current"],[129,26,113,24],[129,28,113,26],[130,8,114,6],[130,14,114,12,"soundRef"],[130,22,114,20],[130,23,114,21,"current"],[130,30,114,28],[130,31,114,29,"stopAsync"],[130,40,114,38],[130,41,114,39],[130,42,114,40],[131,8,115,6],[131,14,115,12,"soundRef"],[131,22,115,20],[131,23,115,21,"current"],[131,30,115,28],[131,31,115,29,"unloadAsync"],[131,42,115,40],[131,43,115,41],[131,44,115,42],[132,8,116,6,"soundRef"],[132,16,116,14],[132,17,116,15,"current"],[132,24,116,22],[132,27,116,25],[132,31,116,29],[133,6,117,4],[134,6,118,4,"setIsPlaying"],[134,18,118,16],[134,19,118,17],[134,24,118,22],[134,25,118,23],[135,4,119,2],[135,5,119,3],[136,4,121,2],[136,11,121,9],[137,6,122,4,"isPlaying"],[137,15,122,13],[138,6,123,4,"isLoading"],[138,15,123,13],[139,6,124,4,"playAudio"],[139,15,124,13],[140,6,125,4,"stopAudio"],[141,4,126,2],[141,5,126,3],[142,2,127,0],[142,3,127,1],[143,0,127,2],[143,3]],"functionMap":{"names":["<global>","useAudioPlayer","playAudio","reader.onloadend","playFromUri","onPlaybackStatusUpdate","stopAudio"],"mappings":"AAA;8BCQ;oBCM;yBC6B;ODgB;GDO;sBGE;GH+B;iCIE;GJQ;oBKE;GLO;CDQ"},"hasCjsExports":false},"type":"js/module"}]}